{% extends "demos.html" %}
{% block content %}
  <script>

  </script>
  <div>
    <div id="builder-basic" class="query-builder form-inline" style="padding:10px">
    </div>
    <div class="btn-group" style="padding:10px">
      <button class="btn btn-primary parse-json" data-target="basic" id="btn-get">Get taxa</button>
    </div>
  </div>
    {% include "sample-query.html" %}
    <script>
      var taxonomy = "greengenes";
      $('#btn-get').on('click', function() {
        var result = $('#builder-basic').queryBuilder('getRules');

        if (!$.isEmptyObject(result)) {
            $.ajax({
              url: '/api/metadata/sample_ids?taxonomy=' + taxonomy,
              data: JSON.stringify($('#builder-basic').queryBuilder('getRules')),
              contentType: "application/json",
              type: "POST",
              success: function(data) {
                $('#example').DataTable( {
                    destroy: true,
                    ajax: {
                        url: "/api/taxonomy/present/group/" + taxonomy,
                        type: "POST",
                        data: function () {
                            return JSON.stringify(
                                data
                            )
                        },
                        contentType: "application/json",
                    },
                    columns: [
                        { data: "sampleId" },
                        { data: "relativeAbundance" },
                        { data: "Kingdom" },
                        { data: "Phylum" },
                        { data: "Class" },
                        { data: "Order" },
                        { data: "Family" },
                        { data: "Genus" },
                    ]
                } );
              }
            });
        }
      });

      $(document).ready(function() {
          $('#example').DataTable( {
              ajax: {
                  url: "/api/taxonomy/present/group/" + taxonomy,
                  type: "POST",
                  data: function () {
                      return JSON.stringify({
                          sample_ids: []
                      })
                  },
                  contentType: "application/json",
              },
              columns: [
                  { data: "sampleId" },
                  { data: "relativeAbundance" },
                  { data: "Kingdom" },
                  { data: "Phylum" },
                  { data: "Class" },
                  { data: "Order" },
                  { data: "Family" },
                  { data: "Genus" },
              ]
          } );
      } );

  </script>
  <div style="padding:10px">
    <table id="example" class="display" style="width:100%">
      <thead>
        <tr>
          <th>Sample ID</th>
          <th>Relative Abundance</th>
          <th>Kingdom</th>
          <th>Phylum</th>
          <th>Class</th>
          <th>Order</th>
          <th>Family</th>
          <th>Genus</th>
        </tr>
      </thead>
    </table>
  </div>
{% endblock %}
